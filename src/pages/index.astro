---
import { getEntry } from "astro:content";
import { format } from "date-fns";

const today = new Date();
const filename = [today.getMonth() + 1, today.getDate()].join("-");
const dateEntry = await getEntry("dates", filename);

if (!dateEntry) {
  return new Response(null, {
    status: 404,
    statusText: "[Date] Content not found",
  });
}

// Resolve `part` reference
const partEntry = await getEntry(dateEntry.data.part);

if (!partEntry) {
  return new Response(null, {
    status: 404,
    statusText: "[Part] Content not found",
  });
}

// Resolve `category` reference
const categoryEntry = await getEntry(dateEntry.data.category);

if (!categoryEntry) {
  return new Response(null, {
    status: 404,
    statusText: "[Category] Content not found",
  });
}

const { Content: DateContent } = await dateEntry.render();
---

<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Daily Stoic</title>
    <meta
      name="description"
      content="Start your day with clarity: A daily dose of Stoic wisdom"
    />

    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß†</text></svg>"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,400;0,700;1,400;1,700&family=IBM+Plex+Serif:ital,wght@0,700;1,700&display=swap"
      rel="stylesheet"
    />
    <style is:inline>
      :root {
        /* Ros√© Pine Dawn */
        --rp-base: 32deg 57% 95%;
        --rp-surface: 35deg 100% 98%;
        --rp-overlay: 33deg 43% 91%;
        --rp-muted: 257deg 9% 61%;
        --rp-subtle: 248deg 12% 52%;
        --rp-text: 248deg 19% 40%;
        --rp-love: 343deg 35% 55%;
        --rp-gold: 35deg 81% 56%;
        --rp-rose: 3deg 53% 67%;
        --rp-pine: 197deg 53% 34%;
        --rp-foam: 189deg 30% 48%;
        --rp-iris: 268deg 21% 57%;
        --rp-highlight-low: 25deg 35% 93%;
        --rp-highlight-med: 10deg 9% 86%;
        --rp-highlight-high: 315deg 4% 80%;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          /* Ros√© Pine Moon */
          --rp-base: 246deg 24% 17%;
          --rp-surface: 248deg 24% 20%;
          --rp-overlay: 248deg 21% 26%;
          --rp-muted: 249deg 12% 47%;
          --rp-subtle: 248deg 15% 61%;
          --rp-text: 245deg 50% 91%;
          --rp-love: 343deg 76% 68%;
          --rp-gold: 35deg 88% 72%;
          --rp-rose: 2deg 66% 75%;
          --rp-pine: 197deg 48% 47%;
          --rp-foam: 189deg 43% 73%;
          --rp-iris: 267deg 57% 78%;
          --rp-highlight-low: 245deg 22% 20%;
          --rp-highlight-med: 247deg 16% 30%;
          --rp-highlight-high: 249deg 15% 38%;
        }
      }
    </style>
  </head>
  <body class="h-full font-sans bg-rp-base text-rp-text">
    <header class="py-4 flex flex-col items-center justify-center gap-1">
      <h1
        set:html={partEntry.data.name}
        style="color: transparent"
        class:list={[
          "text-center font-serif font-bold tracking-widest inline",
          "bg-gradient-to-r from-rp-rose via-rp-iris to-rp-foam bg-clip-text",
        ]}
      />
      <h2
        set:html={categoryEntry.data.name}
        class="font-bold text-xs tracking-wider text-rp-subtle"
      />
    </header>
    <main class="flex items-center justify-center">
      <article class="w-full animate-fade-in-bottom">
        <div class="text-center font-bold tracking-wide text-rp-subtle">
          <time datetime={today.toLocaleDateString()} class="text-rp-gold">
            {format(today, "MMMM do")}
          </time>
        </div>
        <h2 set:html={dateEntry.data.title} class="text-center mt-0" />
        <div class="mt-10 space-y-10">
          <DateContent />
        </div>
      </article>
    </main>
  </body>
</html>
